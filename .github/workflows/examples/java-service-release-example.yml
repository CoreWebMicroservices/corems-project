# Release workflow - triggered when you create a git tag
# Copy this to your service repository as .github/workflows/release.yml
#
# Usage:
#   1. Ensure your project is at X.Y.0-SNAPSHOT
#   2. Create and push a tag: git tag vX.Y.0 && git push origin vX.Y.0
#   3. Workflow will:
#      - Check for SNAPSHOT dependencies (fails if found)
#      - Set version to X.Y.0 (remove SNAPSHOT)
#      - Build and test
#      - Publish Maven artifacts
#      - Build and push Docker images
#      - Commit release version
#      - Bump to X.(Y+1).0-SNAPSHOT
#      - Commit and push next snapshot
#      - Create GitHub release
#
# Example:
#   Current: 1.1.0-SNAPSHOT
#   Tag: v1.1.0
#   Release: 1.1.0
#   Next: 1.2.0-SNAPSHOT

name: Release

on:
  push:
    tags:
      - 'v*'  # Triggers on tags like v1.0.0, v2.1.3, etc.

jobs:
  release:
    uses: CoreWebMicroservices/corems-project/.github/workflows/java-service-release.yml@main
    with:
      service-name: user-ms  # Change to your service name
      java-version: '25'
    secrets:
      github-token: ${{ secrets.GITHUB_TOKEN }}
      docker-username: ${{ secrets.DOCKER_USERNAME }}
      docker-password: ${{ secrets.DOCKER_PASSWORD }}
